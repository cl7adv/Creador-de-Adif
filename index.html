<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Defender: Wilber de Holgu√≠n vs CM6OM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        canvas {
            border: 2px solid #38bdf8;
            background-color: #000;
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.3);
            max-width: 100%;
            max-height: 65vh;
            cursor: crosshair;
            image-rendering: pixelated;
        }
        .ui-panel {
            background: rgba(15, 23, 42, 0.95);
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid #0ea5e9;
            margin-top: 0.5rem;
            width: 95%;
            max-width: 800px;
            z-index: 20;
            backdrop-filter: blur(10px);
        }
        .energy-bar-container {
            width: 100%;
            height: 12px;
            background: #1e293b;
            border-radius: 6px;
            margin-top: 8px;
            overflow: hidden;
            border: 1px solid #334155;
        }
        #energy-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #38bdf8);
            box-shadow: 0 0 10px #0ea5e9;
            transition: width 0.1s;
        }
        #cinematic-overlay {
            position: absolute;
            inset: 0;
            background: black;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            text-align: center;
        }
        #phone-ui {
            width: 260px;
            height: 480px;
            background: #000;
            border: 10px solid #222;
            border-radius: 35px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,1), 0 0 20px rgba(14, 165, 233, 0.2);
            display: none;
        }
        .message-bubble {
            background: #1e40af;
            color: white;
            padding: 10px 14px;
            border-radius: 18px;
            margin: 6px;
            font-size: 13px;
            width: fit-content;
            max-width: 85%;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            animation: slideIn 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .glitch {
            animation: glitch-anim 0.5s infinite;
            text-shadow: 2px 0 red, -2px 0 blue;
        }
        @keyframes glitch-anim {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 1px); }
            40% { transform: translate(2px, -1px); }
            60% { transform: translate(-1px, -2px); }
            80% { transform: translate(1px, 2px); }
            100% { transform: translate(0); }
        }
        .btn-action {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transition: all 0.2s;
        }
        .btn-action:active { transform: scale(0.95); }
        
        /* Mobile controls */
        #mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            gap: 15px;
            z-index: 50;
        }
        .touch-btn {
            width: 70px;
            height: 70px;
            background: rgba(56, 189, 248, 0.2);
            border: 2px solid #38bdf8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }

        @media (max-pointer: coarse) {
            #mobile-controls { display: flex; }
            .ui-panel { font-size: 0.8rem; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="cinematic-overlay">
        <div id="phone-ui">
            <div id="phone-header" class="bg-slate-900 p-3 text-center text-xs font-bold border-b border-slate-700 text-blue-400">WHATSAPP (4348)</div>
            <div id="messages-container" class="p-3 flex flex-col-reverse h-[380px] overflow-hidden bg-slate-950"></div>
            <div id="phone-footer" class="absolute bottom-6 w-full px-4 text-center">
                <div class="h-1.5 bg-blue-500 rounded-full animate-pulse shadow-[0_0_10px_#3b82f6]"></div>
            </div>
            <div id="phone-scanner" class="absolute top-0 left-0 w-full h-[4px] bg-cyan-400 shadow-[0_0_20px_#22d3ee] hidden animate-[scan_2s_linear_infinite]"></div>
        </div>
        
        <div id="intro-text-block" class="max-w-2xl space-y-6 mt-10">
            <h1 class="text-4xl md:text-6xl font-black text-blue-500 glitch uppercase tracking-tighter">Holgu√≠n Bajo Fuego</h1>
            <p id="typewriter" class="text-lg md:text-2xl text-slate-300 font-mono italic min-h-[4em]"></p>
            <div id="intro-buttons" class="hidden flex flex-col items-center gap-4">
                <button id="start-btn" class="btn-action px-10 py-4 rounded-full font-bold uppercase tracking-widest text-lg">ENCENDER TRANSMISOR</button>
                <p class="text-xs text-slate-500 uppercase tracking-widest">Wilber, defiende la frecuencia de los ataques de CM6OM</p>
            </div>
        </div>
    </div>

    <div class="flex justify-between w-full max-w-[800px] mb-2 px-4">
        <div>
            <h1 class="text-lg font-bold text-blue-400 uppercase tracking-tighter">Wilber Station</h1>
            <div id="wave-display" class="text-[10px] text-blue-300 font-mono uppercase tracking-widest">Estado: Operacional | Oleada 1</div>
        </div>
        <div class="text-right">
            <div id="score-display" class="text-lg font-bold text-white">000000</div>
            <div id="health-display" class="text-red-500 text-sm font-bold">EQUIPOS: 100%</div>
        </div>
    </div>

    <div class="relative w-full flex justify-center">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="ui-panel">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
            <div class="text-[11px] text-slate-400 space-y-1 hidden md:block">
                <p><span class="text-blue-400 font-bold">DISPARO:</span> Click/Tap para enviar ondas de choque.</p>
                <p><span class="text-blue-400 font-bold">ESCUDO:</span> Espacio/Bot√≥n para proteger la antena.</p>
                <p><span class="text-red-400 font-bold">ALERTA:</span> CM6OM est√° enviando a sus secuaces directamente a destruir tus transmisores.</p>
            </div>
            <div class="w-full">
                <div class="flex justify-between text-[10px] font-bold text-slate-300">
                    <span class="uppercase">Potencia de Pulso</span>
                    <span id="shield-status" class="text-cyan-400 uppercase">Escudo: Cargando...</span>
                </div>
                <div class="energy-bar-container">
                    <div id="energy-fill"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="mobile-controls">
        <div id="mobile-shield" class="touch-btn shadow-[0_0_15px_rgba(56,189,248,0.5)]">üõ°Ô∏è</div>
    </div>
</div>

<script>
    const AudioEngine = {
        ctx: null,
        init() {
            if (this.ctx) return;
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        },
        play(freq, type, decay, vol) {
            if(!this.ctx) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, this.ctx.currentTime + decay);
            gain.gain.setValueAtTime(vol, this.ctx.currentTime);
            gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + decay);
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.start(); osc.stop(this.ctx.currentTime + decay);
        },
        playVictory() {
            const freqs = [523.25, 659.25, 783.99, 1046.50];
            freqs.forEach((f, i) => setTimeout(() => this.play(f, 'triangle', 0.5, 0.1), i * 150));
        }
    };

    window.onload = function() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const cinematicOverlay = document.getElementById('cinematic-overlay');
        const phoneUi = document.getElementById('phone-ui');
        const messagesContainer = document.getElementById('messages-container');
        const typewriter = document.getElementById('typewriter');
        const startBtn = document.getElementById('start-btn');
        const energyFill = document.getElementById('energy-fill');
        
        canvas.width = 800;
        canvas.height = 500;

        let state = {
            gameActive: false,
            score: 0,
            health: 100,
            energy: 100,
            wave: 1,
            maxWaves: 3,
            enemiesInWave: 0,
            shieldActive: false,
            shieldCooldown: 0,
            frame: 0,
            stars: [],
            particles: [],
            morenitoActive: false,
            finalVictory: false
        };

        // Starfield background
        for(let i=0; i<150; i++) {
            state.stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                z: Math.random() * 2,
                o: Math.random()
            });
        }

        const STORY_LINES = [
            "Holgu√≠n, Cuba. Medianoche.",
            "CM6OM ha hackeado la red para silenciar a Wilber.",
            "Est√° enviando proyecciones de s√≠ mismo para destruir la antena.",
            "Wilber, usa las ondas de radio para defenderte...",
            "¬°El Morenito Electr√≥nico est√° de tu lado!"
        ];

        function startCinematic() {
            let lineIdx = 0;
            function typeLine() {
                if (lineIdx < STORY_LINES.length) {
                    let text = STORY_LINES[lineIdx];
                    let charIdx = 0;
                    typewriter.innerHTML = "";
                    const interval = setInterval(() => {
                        typewriter.innerHTML += text[charIdx];
                        charIdx++;
                        if (charIdx >= text.length) {
                            clearInterval(interval);
                            lineIdx++;
                            setTimeout(typeLine, 1500);
                        }
                    }, 40);
                } else {
                    showPhone();
                }
            }
            typeLine();
        }

        function showPhone() {
            phoneUi.style.display = 'block';
            let msgs = 0;
            const msgInterval = setInterval(() => {
                const bubble = document.createElement('div');
                bubble.className = 'message-bubble';
                bubble.innerText = "¬°CM6OM: Voy directo a por tu antena, Wilber! üòà";
                messagesContainer.prepend(bubble);
                AudioEngine.play(800, 'sine', 0.05, 0.05);
                msgs += 100;
                if (msgs >= 4348) {
                    clearInterval(msgInterval);
                    document.getElementById('intro-buttons').classList.remove('hidden');
                }
            }, 30);
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.life = 1.0;
                this.color = color;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                this.life -= 0.03;
            }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 2, 2);
                ctx.globalAlpha = 1;
            }
        }

        class Enemy {
            constructor() {
                this.reset();
                this.hp = state.wave;
                this.frame = 0;
            }
            reset() {
                // Spawn far away from center
                const side = Math.floor(Math.random() * 4);
                if (side === 0) { this.x = -50; this.y = Math.random() * canvas.height; }
                else if (side === 1) { this.x = canvas.width + 50; this.y = Math.random() * canvas.height; }
                else if (side === 2) { this.x = Math.random() * canvas.width; this.y = -50; }
                else { this.x = Math.random() * canvas.width; this.y = canvas.height + 50; }
                
                this.targetX = canvas.width / 2;
                this.targetY = canvas.height / 2;
                this.speed = (1.2 + state.wave * 0.4);
            }
            update() {
                // Move directly towards the radio station
                const angle = Math.atan2(this.targetY - this.y, this.targetX - this.x);
                this.x += Math.cos(angle) * this.speed;
                this.y += Math.sin(angle) * this.speed;
                this.frame += 0.1;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // Drawing CM6OM (Hacker Character)
                // Cloak/Hoodie
                ctx.fillStyle = '#1e1b4b';
                ctx.shadowBlur = 10; ctx.shadowColor = '#ef4444';
                ctx.beginPath();
                ctx.moveTo(-15, 20); ctx.lineTo(0, -25); ctx.lineTo(15, 20);
                ctx.fill();
                
                // Head/Face (Hidden in shadow)
                ctx.fillStyle = '#000';
                ctx.beginPath(); ctx.arc(0, -5, 8, 0, Math.PI*2); ctx.fill();
                
                // Glowing eyes
                const eyeGlitch = Math.sin(this.frame * 2) > 0 ? '#ef4444' : '#000';
                ctx.fillStyle = eyeGlitch;
                ctx.fillRect(-4, -6, 2, 2); ctx.fillRect(2, -6, 2, 2);
                
                // Floating particles around the hacker
                ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
                for(let i=0; i<3; i++) {
                    const ox = Math.cos(this.frame + i) * 15;
                    const oy = Math.sin(this.frame + i) * 15;
                    ctx.fillRect(ox, oy, 2, 2);
                }
                
                ctx.restore();
            }
        }

        class Morenito {
            constructor() {
                this.x = -100; this.y = -100;
                this.targetX = 400; this.targetY = 250;
            }
            update() {
                this.x += (this.targetX - this.x) * 0.05;
                this.y += (this.targetY - this.y) * 0.05;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                // Aura
                const grad = ctx.createRadialGradient(0,0,0,0,0,70);
                grad.addColorStop(0, 'rgba(56, 189, 248, 0.5)');
                grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.arc(0,0,70,0,Math.PI*2); ctx.fill();
                // Morenito Spirit
                ctx.fillStyle = '#0ea5e9';
                ctx.shadowBlur = 25; ctx.shadowColor = '#38bdf8';
                ctx.beginPath(); ctx.moveTo(0, -45); ctx.lineTo(25, 30); ctx.lineTo(-25, 30);
                ctx.closePath(); ctx.fill();
                // Face/Details
                ctx.fillStyle = '#fff';
                ctx.fillRect(-8, -10, 16, 2);
                ctx.restore();
            }
        }

        let enemies = [];
        let pulses = [];
        let morenito = new Morenito();

        function spawnWave() {
            state.enemiesInWave = 8 + (state.wave * 12);
            document.getElementById('wave-display').innerText = `Alerta: Ataque Directo | Oleada ${state.wave}`;
            const interval = setInterval(() => {
                if (state.enemiesInWave > 0 && state.gameActive) {
                    enemies.push(new Enemy());
                    state.enemiesInWave--;
                } else {
                    clearInterval(interval);
                }
            }, 1200 - (state.wave * 150));
        }

        function update() {
            if (!state.gameActive) return;
            state.frame++;
            
            ctx.fillStyle = '#020617';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars
            state.stars.forEach(s => {
                ctx.fillStyle = `rgba(255,255,255,${s.o})`;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.z, 0, Math.PI*2); ctx.fill();
                s.y += s.z * 0.3;
                if (s.y > canvas.height) s.y = 0;
            });

            const cx = canvas.width/2; const cy = canvas.height/2;
            
            // Shield
            if (state.shieldActive) {
                ctx.beginPath();
                ctx.arc(cx, cy, 110, 0, Math.PI*2);
                ctx.strokeStyle = '#0ea5e9';
                ctx.lineWidth = 5;
                ctx.shadowBlur = 30; ctx.shadowColor = '#0ea5e9';
                ctx.stroke();
                ctx.fillStyle = 'rgba(14, 165, 233, 0.15)';
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // Radio Tower
            ctx.fillStyle = '#334155';
            ctx.fillRect(cx-12, cy-15, 24, 50);
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(cx, cy-15); ctx.lineTo(cx, cy-70); ctx.stroke();
            // Signal Glow
            const glowSize = 20 + Math.sin(state.frame * 0.1) * 10;
            const grad = ctx.createRadialGradient(cx, cy-70, 0, cx, cy-70, glowSize);
            grad.addColorStop(0, 'rgba(56, 189, 248, 0.8)');
            grad.addColorStop(1, 'transparent');
            ctx.fillStyle = grad;
            ctx.beginPath(); ctx.arc(cx, cy-70, glowSize, 0, Math.PI*2); ctx.fill();

            // Pulses
            pulses.forEach((p, i) => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                ctx.strokeStyle = `rgba(56, 189, 248, ${p.a})`;
                ctx.lineWidth = 4;
                ctx.stroke();
                p.r += 10;
                p.a -= 0.04;
                if (p.a <= 0) pulses.splice(i, 1);
            });

            // Particles
            state.particles.forEach((p, i) => {
                p.update(); p.draw();
                if (p.life <= 0) state.particles.splice(i, 1);
            });

            // Enemies (CM6OM Avatars)
            enemies.forEach((e, i) => {
                e.update(); e.draw();
                
                const dist = Math.hypot(e.x - cx, e.y - cy);
                const collisionRadius = state.shieldActive ? 110 : 40;
                
                if (dist < collisionRadius) {
                    if (!state.shieldActive) {
                        state.health -= 15;
                        AudioEngine.play(100, 'sawtooth', 0.3, 0.2);
                        document.getElementById('health-display').innerText = `EQUIPOS: ${state.health}%`;
                        if (state.health <= 0) gameOver(false);
                    } else {
                        AudioEngine.play(800, 'sine', 0.05, 0.1);
                    }
                    enemies.splice(i, 1);
                    for(let k=0; k<15; k++) state.particles.push(new Particle(e.x, e.y, '#ef4444'));
                }

                // Interaction with player pulses
                pulses.forEach(p => {
                    const hitDist = Math.hypot(e.x - p.x, e.y - p.y);
                    if (hitDist < p.r + 20) {
                        e.hp -= 0.6;
                        if (e.hp <= 0) {
                            state.score += 150;
                            document.getElementById('score-display').innerText = state.score.toString().padStart(6, '0');
                            enemies.splice(i, 1);
                            AudioEngine.play(500, 'sine', 0.1, 0.1);
                            for(let k=0; k<20; k++) state.particles.push(new Particle(e.x, e.y, '#38bdf8'));
                        }
                    }
                });
            });

            // Morenito Final Defense
            if (state.wave === 3 && state.enemiesInWave === 0 && enemies.length < 5 && !state.finalVictory) {
                state.morenitoActive = true;
                morenito.update();
                morenito.draw();
                
                enemies.forEach((e, i) => {
                    const d = Math.hypot(e.x - morenito.x, e.y - morenito.y);
                    if (d < 120) {
                        enemies.splice(i, 1);
                        state.score += 300;
                        for(let k=0; k<30; k++) state.particles.push(new Particle(e.x, e.y, '#fff'));
                    }
                });
                if (enemies.length === 0) triggerFinalCinematic();
            }

            // Energy & UI
            if (state.energy < 100) state.energy += 0.4;
            energyFill.style.width = state.energy + '%';
            
            if (state.shieldCooldown > 0) {
                state.shieldCooldown--;
                document.getElementById('shield-status').innerText = "Cargando...";
            } else {
                document.getElementById('shield-status').innerText = "Escudo: LISTO";
            }

            if (state.enemiesInWave === 0 && enemies.length === 0 && state.wave < state.maxWaves) {
                state.wave++;
                spawnWave();
            }

            requestAnimationFrame(update);
        }

        function triggerFinalCinematic() {
            state.finalVictory = true;
            state.gameActive = false;
            cinematicOverlay.style.display = 'flex';
            phoneUi.style.display = 'block';
            document.getElementById('intro-text-block').innerHTML = `
                <h1 class="text-3xl font-bold text-cyan-400 mb-2 uppercase">Morenito Protocol</h1>
                <p class="text-slate-400">Desmantelando la red de CM6OM...</p>
            `;
            
            setTimeout(() => {
                document.getElementById('phone-scanner').classList.remove('hidden');
                AudioEngine.play(1000, 'sawtooth', 1, 0.1);
                
                setTimeout(() => {
                    messagesContainer.innerHTML = `
                        <div class="message-bubble bg-cyan-700 font-bold">‚úì HACKER CM6OM EXPULSADO</div>
                        <div class="message-bubble bg-cyan-700">‚úì ANTENA REESTABLECIDA</div>
                        <div class="message-bubble bg-cyan-700">‚úì WILBER EST√Å AL AIRE</div>
                    `;
                    document.getElementById('phone-header').innerText = "ANTENA: ONLINE";
                    document.getElementById('phone-header').className = "bg-cyan-900 p-3 text-center text-xs font-bold border-b border-cyan-700 text-white";
                    AudioEngine.playVictory();
                    
                    setTimeout(() => gameOver(true), 3500);
                }, 2000);
            }, 1000);
        }

        function gameOver(victory) {
            state.gameActive = false;
            cinematicOverlay.style.display = 'flex';
            phoneUi.style.display = 'none';
            document.getElementById('intro-text-block').innerHTML = `
                <h1 class="text-6xl font-black mb-4 ${victory ? 'text-cyan-400' : 'text-red-600'}">${victory ? 'ANTENA SEGURA' : 'RADIO APAGADA'}</h1>
                <p class="text-xl text-slate-300 mb-8">${victory ? 'CM6OM ha fallado. Holgu√≠n sigue escuchando a Wilber.' : 'CM6OM ha destruido la se√±al. La frecuencia 98.5 est√° en silencio.'}</p>
                <button onclick="location.reload()" class="btn-action px-12 py-5 rounded-full font-bold uppercase text-xl">REINICIAR TRANSMISI√ìN</button>
            `;
        }

        const createPulse = (x, y) => {
            if (state.energy >= 20) {
                state.energy -= 20;
                pulses.push({x, y, r: 10, a: 1});
                AudioEngine.play(700, 'sine', 0.2, 0.1);
            }
        };

        const activateShield = () => {
            if (state.shieldCooldown <= 0) {
                state.shieldActive = true;
                state.shieldCooldown = 400;
                AudioEngine.play(200, 'square', 0.4, 0.1);
                setTimeout(() => state.shieldActive = false, 2500);
            }
        };

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            createPulse(x, y);
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
            const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
            createPulse(x, y);
        }, {passive: false});

        document.getElementById('mobile-shield').addEventListener('touchstart', (e) => {
            e.preventDefault();
            activateShield();
        });

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') activateShield();
        });

        startBtn.addEventListener('click', () => {
            AudioEngine.init();
            cinematicOverlay.style.display = 'none';
            state.gameActive = true;
            spawnWave();
            update();
        });

        startCinematic();
    };
</script>
</body>
</html>
